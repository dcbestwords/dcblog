<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.59" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://github.com/paper/code/torch_api.html"><meta property="og:site_name" content="dcBlog"><meta property="og:title" content="pytorchåŸºç¡€"><meta property="og:description" content="ä¸€ã€å¯¼å…¥æ•°æ®é›† 1. å¤„ç†æ•°æ®é›† torch.utils.data.TensorDataset(*tensors) è¿™æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªæ•°æ®é›†ç±»ï¼Œç”¨äºé’ˆå¯¹å¼ é‡æ•°æ®åˆ›å»ºæ•°æ®é›†ï¼Œå³å°†å¼ é‡è¡¨ç¤ºçš„æ•°æ®å°è£…ä¸ºæ•°æ®é›†å¯¹è±¡ï¼Œä»¥ä¾¿äºä¹‹åç”¨äºè®­ç»ƒæ¨¡å‹ã€‚ è¯¥ç±»æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå¼ é‡ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­æ¯ä¸ªå¼ é‡è¡¨ç¤ºæ•°æ®é›†ä¸­çš„ä¸€ä¸ªç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®é›†åŒ…å«å›¾åƒå’Œç›¸åº”çš„æ ‡ç­¾..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-12-03T11:20:13.000Z"><meta property="article:tag" content="pytorch"><meta property="article:modified_time" content="2024-12-03T11:20:13.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"pytorchåŸºç¡€","image":[""],"dateModified":"2024-12-03T11:20:13.000Z","author":[{"@type":"Person","name":"Dachao","email":"wyc168hard@163.com"}]}</script><meta name="application-name" content="dcBlog"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#46bd87"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><title>pytorchåŸºç¡€ | dcBlog</title><meta name="description" content="ä¸€ã€å¯¼å…¥æ•°æ®é›† 1. å¤„ç†æ•°æ®é›† torch.utils.data.TensorDataset(*tensors) è¿™æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªæ•°æ®é›†ç±»ï¼Œç”¨äºé’ˆå¯¹å¼ é‡æ•°æ®åˆ›å»ºæ•°æ®é›†ï¼Œå³å°†å¼ é‡è¡¨ç¤ºçš„æ•°æ®å°è£…ä¸ºæ•°æ®é›†å¯¹è±¡ï¼Œä»¥ä¾¿äºä¹‹åç”¨äºè®­ç»ƒæ¨¡å‹ã€‚ è¯¥ç±»æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå¼ é‡ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­æ¯ä¸ªå¼ é‡è¡¨ç¤ºæ•°æ®é›†ä¸­çš„ä¸€ä¸ªç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®é›†åŒ…å«å›¾åƒå’Œç›¸åº”çš„æ ‡ç­¾...">
    <link rel="preload" href="/assets/style-C54W3DA-.css" as="style"><link rel="stylesheet" href="/assets/style-C54W3DA-.css">
    
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">dcBlog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-house fas" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç¼–ç¨‹å­¦ä¹ "><!--[--><span class="font-icon icon fa-keyboard fas" style=""></span>ç¼–ç¨‹å­¦ä¹ <!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/basic_language/" aria-label="å‰ç«¯åŸºç¡€"><!--[--><span class="font-icon icon fa-code fas" style=""></span><!--]-->å‰ç«¯åŸºç¡€<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/source_code/" aria-label="æºç è§£æ"><!--[--><span class="font-icon icon fa-file-code fas" style=""></span><!--]-->æºç è§£æ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/Efficiency/" aria-label="æ•ˆç‡åä½œ"><!--[--><span class="font-icon icon fa-user-group fas" style=""></span><!--]-->æ•ˆç‡åä½œ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/browser_internet/" aria-label="æµè§ˆå™¨é€šä¿¡"><!--[--><span class="font-icon icon fa-globe fas" style=""></span><!--]-->æµè§ˆå™¨é€šä¿¡<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/algorithm/" aria-label="ç®—æ³•"><!--[--><span class="font-icon icon fa-network-wired fas" style=""></span><!--]-->ç®—æ³•<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/Server/" aria-label="æœåŠ¡ç«¯"><!--[--><span class="font-icon icon fa-laptop-code fas" style=""></span><!--]-->æœåŠ¡ç«¯<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/life/" aria-label="ç”Ÿæ´»éšç¬”"><!--[--><span class="font-icon icon fa-wine-bottle fas" style=""></span><!--]-->ç”Ÿæ´»éšç¬”<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/paper/" aria-label="è¯¾é¢˜å…¬è€ƒ"><!--[--><span class="font-icon icon fa-graduation-cap fas" style=""></span><!--]-->è¯¾é¢˜å…¬è€ƒ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/reference/" aria-label="æ–‡æ¡£æ•™ç¨‹"><!--[--><span class="font-icon icon fa-book fas" style=""></span><!--]-->æ–‡æ¡£æ•™ç¨‹<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/dcbestwords" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢æ–‡æ¡£"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢æ–‡æ¡£</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">pytorch</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/paper/code/torch_api.html" aria-label="pytorchåŸºç¡€"><!--[--><span class="font-icon icon fa-fire fas" style=""></span><!--]-->pytorchåŸºç¡€<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-user-graduate fas" style=""></span><span class="vp-sidebar-title">å…¬è€ƒç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fire fas" style=""></span>pytorchåŸºç¡€</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Dachao</span></span><span property="author" content="Dachao"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2024å¹´3æœˆ19æ—¥</span><meta property="datePublished" content="2024-03-19T13:13:32.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 24 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT24M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color4 clickable" role="navigation">æ·±åº¦å­¦ä¹ </span><!--]--><meta property="articleSection" content="æ·±åº¦å­¦ä¹ "></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color5 clickable" role="navigation">pytorch</span><!--]--><meta property="keywords" content="pytorch"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸€ã€å¯¼å…¥æ•°æ®é›†">ä¸€ã€å¯¼å…¥æ•°æ®é›†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å¤„ç†æ•°æ®é›†">1. å¤„ç†æ•°æ®é›†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-é›†æˆçš„æ•°æ®é›†">2. é›†æˆçš„æ•°æ®é›†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äºŒã€ä¼˜åŒ–ç®—æ³•">äºŒã€ä¼˜åŒ–ç®—æ³•</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è®­ç»ƒä¼˜åŒ–ä¸­çš„é—®é¢˜">1. è®­ç»ƒä¼˜åŒ–ä¸­çš„é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä¼˜åŒ–ç®—æ³•">2. ä¼˜åŒ–ç®—æ³•</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸‰ã€ç½‘ç»œå±‚ç»“æ„">ä¸‰ã€ç½‘ç»œå±‚ç»“æ„</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å±•å¹³å±‚">1. å±•å¹³å±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å·ç§¯å±‚">2. å·ç§¯å±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-æ± åŒ–å±‚">3. æ± åŒ–å±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-dropout">4. Dropout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-batchnorm">5. BatchNorm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-relu">6. Relu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-åå·ç§¯å±‚">7. åå·ç§¯å±‚</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å››ã€å‚æ•°è®¿é—®">å››ã€å‚æ•°è®¿é—®</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-named-parameters-æˆ–parameters">1. named_parameters()æˆ–parameters()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-model-layer-weight">2. model.layer.weight</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-state-dict">3. state_dict</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº”ã€ä¿å­˜å’Œè¯»å–æ¨¡å‹å‚æ•°">äº”ã€ä¿å­˜å’Œè¯»å–æ¨¡å‹å‚æ•°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä¿å­˜å’Œè¯»å–">1. ä¿å­˜å’Œè¯»å–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-æŸ¥çœ‹æ•°æ®ç»“æ„">2. æŸ¥çœ‹æ•°æ®ç»“æ„</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…­ã€gpu-ç›¸å…³">å…­ã€GPU ç›¸å…³</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å°†æ¨¡å‹å‚æ•°æ”¾åœ¨-gpu">1. å°†æ¨¡å‹å‚æ•°æ”¾åœ¨ gpu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åˆ‡æ¢æ¨¡å‹æ¨¡å¼">2. åˆ‡æ¢æ¨¡å‹æ¨¡å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¸ƒã€æ³¨æ„åŠ›æœºåˆ¶">ä¸ƒã€æ³¨æ„åŠ›æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…«ã€ä¸€äº›é€šç”¨å‡½æ•°">å…«ã€ä¸€äº›é€šç”¨å‡½æ•°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è®­ç»ƒå‡½æ•°">1. è®­ç»ƒå‡½æ•°</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h2 id="ä¸€ã€å¯¼å…¥æ•°æ®é›†" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å¯¼å…¥æ•°æ®é›†"><span>ä¸€ã€å¯¼å…¥æ•°æ®é›†</span></a></h2><h3 id="_1-å¤„ç†æ•°æ®é›†" tabindex="-1"><a class="header-anchor" href="#_1-å¤„ç†æ•°æ®é›†"><span>1. å¤„ç†æ•°æ®é›†</span></a></h3><blockquote><p><code>torch.utils.data.TensorDataset(*tensors)</code></p></blockquote><p>è¿™æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªæ•°æ®é›†ç±»ï¼Œç”¨äºé’ˆå¯¹<strong>å¼ é‡æ•°æ®</strong>åˆ›å»ºæ•°æ®é›†ï¼Œå³<strong style="color:red;">å°†å¼ é‡è¡¨ç¤ºçš„æ•°æ®å°è£…ä¸ºæ•°æ®é›†å¯¹è±¡</strong>ï¼Œä»¥ä¾¿äºä¹‹åç”¨äºè®­ç»ƒæ¨¡å‹ã€‚</p><p>è¯¥ç±»æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå¼ é‡ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­æ¯ä¸ªå¼ é‡è¡¨ç¤ºæ•°æ®é›†ä¸­çš„ä¸€ä¸ªç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®é›†åŒ…å«å›¾åƒå’Œç›¸åº”çš„æ ‡ç­¾ï¼Œåˆ™éœ€è¦ä½¿ç”¨ä¸¤ä¸ªå¼ é‡æ¥æè¿°æ•°æ®é›†ï¼Œä¸€ä¸ªå¼ é‡è¡¨ç¤ºå›¾åƒæ•°æ®ï¼Œå¦ä¸€ä¸ªå¼ é‡è¡¨ç¤ºæ ‡ç­¾æ•°æ®ã€‚</p><p>è¯¥ç±»çš„åˆå§‹åŒ–å‡½æ•°å°†æ‰€æœ‰å‚æ•°åˆå¹¶ä¸ºä¸€ä¸ªå¼ é‡å…ƒç»„ï¼Œå³ <code>(*tensors)</code>ï¼ŒåŒæ—¶è¿˜å¯ä»¥å®šä¹‰ä¸€äº›é¢å¤–çš„å‚æ•°ï¼Œä¾‹å¦‚ <code>transform=None</code> ç”¨äºå¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œ<code>target_transform=None</code> ç”¨äºå¯¹æ ‡ç­¾è¿›è¡Œè½¬æ¢ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ª <code>TensorDataset</code> å¯¹è±¡ï¼ŒåŒ…å«æ•°æ® <code>X</code> å’Œæ ‡ç­¾ <code>y</code>ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.utils.data </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TensorDataset</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ds </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> TensorDataset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(X, y)</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º <code>(100, 10)</code> çš„å¼ é‡ <code>X</code>ï¼Œå’Œä¸€ä¸ªå¤§å°ä¸º <code>(100,)</code> çš„å¼ é‡ <code>y</code>ï¼Œåˆ†åˆ«ä»£è¡¨è¾“å…¥æ•°æ®å’Œæ ‡ç­¾ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>TensorDataset</code> å¯¹è±¡ <code>ds</code>ï¼Œå°† <code>X</code> å’Œ <code>y</code> ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å°†æ•°æ® <code>X</code> ä¸æ ‡ç­¾ <code>y</code> å°è£…ä¸ºäº†ä¸€ä¸ª PyTorch çš„æ•°æ®é›†å¯¹è±¡ï¼Œå³ <code>ds</code>ã€‚</p><blockquote><p><code>torch.utils.data.Dataset</code></p></blockquote><p>è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨ä½œè‡ªå®šä¹‰æ•°æ®é›†çš„åŸºç¡€ã€‚å¦‚æœè¦<strong>è‡ªå®šä¹‰æ•°æ®é›†</strong>ï¼Œéœ€è¦ç»§æ‰¿å®ƒå¹¶å®ç°å…¶ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼š<code>len()</code> å’Œ <code>getItem()</code>ã€‚</p><p><code>len()</code> æ–¹æ³•è¿”å›æ•°æ®é›†ä¸­çš„æ ·æœ¬æ•°é‡ï¼Œ<code>getitem()</code> æ–¹æ³•ä¼ é€’æ ·æœ¬ç´¢å¼•å¹¶è¿”å›æ ·æœ¬åŠå…¶æ ‡ç­¾ï¼ˆå¦‚æœä¸éœ€è¦æ ‡ç­¾ï¼Œåˆ™å¯ä»¥é€‰æ‹©çœç•¥ï¼‰ã€‚åœ¨<code>__init__</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®é›†è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Pandas åº“ç­‰æ¥è¯»å– CSV æ ¼å¼çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå·±ç¼–å†™å‡½æ•°è¯»å–å›¾åƒæ•°æ®ã€‚</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.utils.data </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Dataset</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pandas </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pd</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;"> PIL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Image</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyCustomDataset</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Dataset</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> csv_file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> root_dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> transform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">None</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        csv_file (string): æ–‡ä»¶è·¯å¾„ï¼ŒåŒ…æ‹¬æ ‡ç­¾å’Œå›¾åƒä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        root_dir (string): å›¾åƒæ‰€åœ¨çš„ç›®å½•ã€‚</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        transform (callable, optional): å¯é€‰çš„å›¾ç‰‡è½¬æ¢(è‡ªå®šä¹‰æˆ–PyTorchä¸­çš„)æ“ä½œæ¥å¢å¼ºæ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.annotations </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pd.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">read_csv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(csv_file)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.root_dir </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> root_dir</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.transform </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> transform</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __len__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> len</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.annotations)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __getitem__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> index</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        img_path </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> os.path.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.root_dir, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.annotations.iloc[index, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        image </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Image.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(img_path)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        label </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.annotations.iloc[index, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.transform:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            image </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">transform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(image)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (image, label)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>DataLoader</code> ç±»æ¥ä½¿ç”¨ <code>TensorDataset</code> æˆ–è€…<code>Dataset</code>å¯¹è±¡ï¼Œä»è€Œå®ç°æ‰¹é‡åŠ è½½æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œæ•°æ®å¢å¼ºå’Œå¤šçº¿ç¨‹åŠ è½½ç­‰æ“ä½œã€‚</li></ul><blockquote><p><code>torch.utils.data.DataLoader(dataset, batch_size=1, shuffle=False, sampler=None, num_workers=0, collate_fn=None, pin_memory=False, drop_last=False)</code></p></blockquote><p>è¿™æ˜¯ PyTorch ä¸­ç”¨äº<strong>æ•°æ®åŠ è½½</strong>çš„å·¥å…·ç±»ï¼Œç”¨äº<strong style="color:red;">åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ‰¹é‡åŠ è½½æ•°æ®ï¼Œè¿›è¡Œæ•°æ®å¢å¼ºã€æ•°æ®åˆ’åˆ†å’Œå¤šçº¿ç¨‹ç­‰æ“ä½œ</strong>ã€‚</p><ul><li><code>dataset</code>: åŠ è½½æ•°æ®æ‰€åœ¨çš„æ•°æ®é›†ã€‚</li><li><code>batch_size</code>: æ‰¹å¤„ç†å¤§å°ã€‚</li><li><code>shuffle</code>: æ˜¯å¦æ‰“ä¹±æ•°æ®ã€‚</li><li><code>sampler</code>: æ ·æœ¬æŠ½æ ·æ–¹å¼ï¼Œå¯ä»¥è‡ªå®šä¹‰ã€‚</li><li><code>num_workers</code>: çº¿ç¨‹çš„æ•°é‡ï¼Œ0 è¡¨ç¤ºä¸ä½¿ç”¨å¤šçº¿ç¨‹ã€‚</li><li><code>collate_fn</code>: è‡ªå®šä¹‰çš„ batch æ“ä½œã€‚</li><li><code>pin_memory</code>: æ˜¯å¦å°†æ•°æ®ä¿å­˜åˆ° CUDA çš„å›ºå®šå†…å­˜ä¸Šï¼Œæé«˜ GPU æ•ˆç‡ã€‚</li><li><code>drop_last</code>: å¦‚æœ dataset ä¸­æ•°æ®æ€»æ•°ä¸èƒ½è¢« batch_size æ•´é™¤ï¼Œåˆ™ drop_last å¦‚æœä¸º Trueï¼Œåˆ™å°†å¤šä½™çš„æ•°æ®åˆ é™¤ï¼›å¦åˆ™æ”¾åˆ°æœ€åä¸€ä¸ª batch é‡Œå»ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>DataLoader</code> åŠ è½½ä¸€ä¸ª <code>TensorDataset</code> å¯¹è±¡ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.utils.data </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> TensorDataset, DataLoader</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">ds </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> TensorDataset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(X, y)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">loader </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> DataLoader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ds, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">batch_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">shuffle</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> batch_idx, (data, target) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> enumerate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(loader):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è¿›è¡Œè®­ç»ƒæˆ–æ¨ç†çš„ä»£ç     pass</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º <code>(100, 10)</code> çš„æ•°æ®å¼ é‡ <code>X</code> å’Œå¤§å°ä¸º <code>(100,)</code> çš„æ ‡ç­¾å¼ é‡ <code>y</code>ï¼Œç„¶åä½¿ç”¨ <code>TensorDataset</code> å°†è¿™ä¸¤ä¸ªå¼ é‡å°è£…æˆä¸€ä¸ªæ•°æ®é›† <code>ds</code>ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>DataLoader</code> å¯¹è±¡ <code>loader</code> åŠ è½½æ•°æ®é›†ï¼Œæ‰¹å¤„ç†å¤§å°ä¸º 10ï¼Œshuffle ä¸º True è¡¨ç¤ºæ¯ä¸ª epoch éƒ½ä¼šå¯¹æ•°æ®è¿›è¡Œéšæœºæ‰“ä¹±ã€‚åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>enumerate</code> å‡½æ•°å¯¹ <code>loader</code> è¿›è¡Œè¿­ä»£ï¼Œé€šè¿‡ <code>(data, target)</code> è·å–æ¯ä¸ªæ‰¹æ¬¡çš„è¾“å…¥æ•°æ®å’Œæ ‡ç­¾æ•°æ®ï¼Œè¿›è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ã€‚</p><p>ä»¥ä¸‹ä»£ç å±•ç¤ºä½¿ç”¨<code>DataLoader</code> åŠ è½½ä¸€ä¸ª <code>Dataset</code> å¯¹è±¡ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">custom_dataset </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> MyCustomDataset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(data,csv_file, root_dir)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä½¿ç”¨ DataLoader åŠ è½½æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dataloader </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> DataLoader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(custom_dataset, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">batch_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">shuffle</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¿­ä»£ DataLoader å¹¶æ‰“å°æ•°æ®å’Œæ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> inputs, labels </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dataloader:</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(inputs, labels)</span></span></code></pre></div><h3 id="_2-é›†æˆçš„æ•°æ®é›†" tabindex="-1"><a class="header-anchor" href="#_2-é›†æˆçš„æ•°æ®é›†"><span>2. é›†æˆçš„æ•°æ®é›†</span></a></h3><blockquote><p><code>torchvision.datasets</code></p></blockquote><p><code>torchvision</code> æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªè§†è§‰å¤„ç†åº“ï¼Œæä¾›äº†æ•°æ®é›†ã€å›¾ç‰‡å˜æ¢ç­‰ä¸€ç³»åˆ—å›¾åƒå¤„ç†æ“ä½œã€‚</p><p><code>torchvision.datasets</code> ä¸­åŒ…å«äº†ä¸€äº›å¸¸ç”¨çš„æ•°æ®é›†ï¼Œä¾‹å¦‚ <code>MNISTã€CIFAR10ã€CIFAR100ã€ImageNet</code> ç­‰ã€‚è¿™äº›æ•°æ®é›†é€šå¸¸æ˜¯ç”¨äºæµ‹è¯•å’Œæ¯”è¾ƒä¸åŒæ¨¡å‹çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨äºè®­ç»ƒæ¨¡å‹ã€‚</p><p>ä½¿ç”¨ <code>torchvision.datasets</code> å¯ä»¥æ–¹ä¾¿åœ°ä¸‹è½½ã€åŠ è½½å’Œé¢„å¤„ç†è¿™äº›å¸¸ç”¨æ•°æ®é›†ã€‚å¸¸ç”¨å‡½æ•°å’Œå‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><p><code>torchvision.datasets.MNIST</code></p><p>ï¼šåŠ è½½ MNIST æ•°æ®é›†ã€‚</p><ul><li><code>root</code>ï¼šMNIST æ•°æ®é›†çš„æ ¹ç›®å½•ã€‚</li><li><code>train</code>ï¼šé€‰æ‹©æ˜¯å¦åŠ è½½è®­ç»ƒé›†ï¼Œé»˜è®¤ä¸º Trueã€‚</li><li><code>transform</code>ï¼šæ•°æ®é¢„å¤„ç†å‡½æ•°ï¼Œä¾‹å¦‚ç¼©æ”¾ã€å‰ªè£ã€éšæœºåˆ‡å‰²ç­‰ã€‚</li><li><code>target_transform</code>ï¼šæ ‡ç­¾æ•°æ®çš„é¢„å¤„ç†å‡½æ•°ã€‚</li><li><code>download</code>ï¼šæ˜¯å¦ä¸‹è½½ MNIST æ•°æ®é›†ã€‚å¦‚æœæ•°æ®å·²ç»ä¸‹è½½è¿‡ï¼Œåˆ™ä¼šç›´æ¥è¯»å–æœ¬åœ°æ•°æ®ã€‚</li></ul></li><li><p><code>torchvision.datasets.CIFAR10</code>ï¼šåŠ è½½ CIFAR10 æ•°æ®é›†ï¼Œå‚æ•°å’Œ MNIST æ•°æ®é›†ç±»ä¼¼ã€‚</p></li></ul><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç»™å‡ºäº†å¦‚ä½•ä½¿ç”¨ <code>torchvision.datasets</code> åŠ è½½ MNIST æ•°æ®é›†å¹¶è¿›è¡Œæ•°æ®é¢„å¤„ç†ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torchvision.datasets </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> datasets</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torchvision.transforms </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> transforms</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ•°æ®é¢„å¤„ç†ï¼Œå°†è¾“å…¥æ•°æ®æ”¾ç¼©åˆ° (0, 1) èŒƒå›´å†…</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">transform </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> transforms.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Compose</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    [transforms.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">ToTensor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     transforms.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Normalize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,), (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,))])</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¸‹è½½å’ŒåŠ è½½æ•°æ®é›†</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">train_data </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> datasets.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">MNIST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;data/MNIST&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">train</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">download</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">transform</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">transform) test_data </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> datasets.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">MNIST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;data/MNIST&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">train</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">False</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">download</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">transform</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">transform)</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªæ•°æ®é¢„å¤„ç†å‡½æ•° <code>transform</code>ï¼Œå°†è¾“å…¥æ•°æ®æ”¾ç¼©åˆ° (0, 1) èŒƒå›´å†…ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>datasets.MNIST</code> æ¥ä¸‹è½½å’ŒåŠ è½½ MNIST æ•°æ®é›†ï¼Œå…¶ä¸­ä¼ å…¥äº†ä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚ <code>root</code> è¡¨ç¤ºæ•°æ®å­˜æ”¾çš„æ ¹ç›®å½•ï¼Œ<code>train</code> è¡¨ç¤ºåŠ è½½è®­ç»ƒæ•°æ®é›†ï¼Œ<code>transform</code> æ˜¯æ•°æ®é¢„å¤„ç†å‡½æ•°ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°äº† <code>train_data</code> å’Œ <code>test_data</code> ä¸¤ä¸ªæ•°æ®é›†å¯¹è±¡ï¼Œåˆ†åˆ«ç”¨äºæ¨¡å‹çš„è®­ç»ƒå’Œæµ‹è¯•ã€‚</p><h2 id="äºŒã€ä¼˜åŒ–ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#äºŒã€ä¼˜åŒ–ç®—æ³•"><span>äºŒã€ä¼˜åŒ–ç®—æ³•</span></a></h2><h3 id="_1-è®­ç»ƒä¼˜åŒ–ä¸­çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_1-è®­ç»ƒä¼˜åŒ–ä¸­çš„é—®é¢˜"><span>1. è®­ç»ƒä¼˜åŒ–ä¸­çš„é—®é¢˜</span></a></h3><p><strong>å±€éƒ¨æœ€å°å€¼</strong></p><p>æ·±åº¦å­¦ä¹ æ¨¡å‹çš„ç›®æ ‡å‡½æ•°é€šå¸¸æœ‰è®¸å¤šå±€éƒ¨æœ€ä¼˜è§£ã€‚å½“ä¼˜åŒ–é—®é¢˜çš„æ•°å€¼è§£æ¥è¿‘å±€éƒ¨æœ€ä¼˜å€¼æ—¶ï¼Œéšç€ç›®æ ‡å‡½æ•°è§£çš„æ¢¯åº¦æ¥è¿‘æˆ–å˜ä¸ºé›¶ï¼Œé€šè¿‡æœ€ç»ˆè¿­ä»£è·å¾—çš„æ•°å€¼è§£å¯èƒ½ä»…ä½¿ç›®æ ‡å‡½æ•°<em>å±€éƒ¨</em>æœ€ä¼˜ï¼Œè€Œä¸æ˜¯<em>å…¨å±€</em>æœ€ä¼˜ã€‚åªæœ‰ä¸€å®šç¨‹åº¦çš„å™ªå£°å¯èƒ½ä¼šä½¿å‚æ•°è·³å‡ºå±€éƒ¨æœ€å°å€¼ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™çš„æœ‰åˆ©ç‰¹æ€§ä¹‹ä¸€ã€‚</p><figure><img src="/assets/local_minimum-BYhjLrU-.svg" alt="../_images/output_optimization-intro_70d214_51_0.svg" tabindex="0" loading="lazy"><figcaption>../_images/output_optimization-intro_70d214_51_0.svg</figcaption></figure><p><strong>éç‚¹</strong></p><p>é™¤äº†å±€éƒ¨æœ€å°å€¼ä¹‹å¤–ï¼Œéç‚¹æ˜¯æ¢¯åº¦æ¶ˆå¤±çš„å¦ä¸€ä¸ªåŸå› ã€‚<em>éç‚¹</em>ï¼ˆsaddle pointï¼‰æ˜¯æŒ‡å‡½æ•°çš„æ‰€æœ‰æ¢¯åº¦éƒ½æ¶ˆå¤±ä½†æ—¢ä¸æ˜¯å…¨å±€æœ€å°å€¼ä¹Ÿä¸æ˜¯å±€éƒ¨æœ€å°å€¼çš„ä»»ä½•ä½ç½®ã€‚è€ƒè™‘è¿™ä¸ªå‡½æ•° f(x)=x^3ã€‚å®ƒçš„ä¸€é˜¶å’ŒäºŒé˜¶å¯¼æ•°åœ¨ x=0 æ—¶æ¶ˆå¤±ã€‚è¿™æ—¶ä¼˜åŒ–å¯èƒ½ä¼šåœæ­¢ï¼Œå°½ç®¡å®ƒä¸æ˜¯æœ€å°å€¼ã€‚</p><figure><img src="/assets/saddle-vClhm6ni.svg" alt="../_images/output_optimization-intro_70d214_66_0.svg" tabindex="0" loading="lazy"><figcaption>../_images/output_optimization-intro_70d214_66_0.svg</figcaption></figure><p><strong>æ¢¯åº¦æ¶ˆå¤±</strong></p><p>å‡è®¾æˆ‘ä»¬æƒ³æœ€å°åŒ–å‡½æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><mtext>â¡</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)=tanhâ¡(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">anh</span><span class="mord">â¡</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ï¼Œç„¶åæˆ‘ä»¬æ°å¥½ä»<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">x=4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span>å¼€å§‹ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œf çš„æ¢¯åº¦æ¥è¿‘é›¶ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mtext>â€²</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mi>t</mi><mi>a</mi><mi>n</mi><msup><mi>h</mi><mn>2</mn></msup><mtext>â¡</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">fâ€²(x)=1âˆ’tanh^2â¡(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">â€²</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord">â¡</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ï¼Œå› æ­¤æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mtext>â€²</mtext><mo stretchy="false">(</mo><mn>4</mn><mo stretchy="false">)</mo><mo>=</mo><mn>0.0013</mn></mrow><annotation encoding="application/x-tex">fâ€²(4)=0.0013</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">â€²</span><span class="mopen">(</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.0013</span></span></span></span>ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬å–å¾—è¿›å±•ä¹‹å‰ï¼Œä¼˜åŒ–å°†ä¼šåœæ»å¾ˆé•¿ä¸€æ®µæ—¶é—´ã€‚äº‹å®è¯æ˜ï¼Œè¿™æ˜¯åœ¨å¼•å…¥ ReLU æ¿€æ´»å‡½æ•°ä¹‹å‰è®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ç›¸å½“æ£˜æ‰‹çš„åŸå› ä¹‹ä¸€ã€‚</p><figure><img src="/assets/gradient-tiKjipcT.svg" alt="../_images/output_optimization-intro_70d214_96_0.svg" tabindex="0" loading="lazy"><figcaption>../_images/output_optimization-intro_70d214_96_0.svg</figcaption></figure><h3 id="_2-ä¼˜åŒ–ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#_2-ä¼˜åŒ–ç®—æ³•"><span>2. ä¼˜åŒ–ç®—æ³•</span></a></h3><p><strong>éšæœºæ¢¯åº¦ä¸‹é™</strong></p><blockquote><p><code>torch.optim.SGD(params, lr, momentum=0, dampening=0, weight_decay=0, nesterov=False)</code></p></blockquote><p><code>torch.optim.SGD(params, lr, momentum=0, dampening=0, weight_decay=0, nesterov=False)</code> æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªä¼˜åŒ–å™¨ç±»ï¼Œå®ç°äº†éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯å¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•ä¹‹ä¸€ï¼Œé€šè¿‡è®¡ç®—å½“å‰æ¢¯åº¦å’Œå†å²æ¢¯åº¦çš„åŠ æƒå¹³å‡å€¼æ¥æ›´æ–°æ¨¡å‹å‚æ•°ã€‚</p><ul><li><code>params</code>ï¼šå¾…ä¼˜åŒ–çš„å‚æ•°ã€‚</li><li><code>lr</code>ï¼šå­¦ä¹ ç‡ï¼Œæ§åˆ¶æ¯æ¬¡æ›´æ–°çš„æ­¥é•¿å¤§å°ã€‚</li><li><code>momentum</code>ï¼šåŠ¨é‡ï¼ˆMomentumï¼‰å› å­ï¼ŒåŠ é€Ÿä¼˜åŒ–è¿‡ç¨‹ï¼Œé˜²æ­¢å‚æ•°åœ¨æ›´æ–°æ–¹å‘æ”¹å˜æ—¶æ¥å›æ‘†åŠ¨ã€‚é»˜è®¤å€¼ä¸º 0ã€‚</li><li><code>dampening</code>ï¼šåŠ¨é‡çš„æŠ‘åˆ¶å› å­ï¼ŒèŒƒå›´ä¸º [0, 1]ã€‚é»˜è®¤å€¼ä¸º 0ã€‚</li><li><code>weight_decay</code>ï¼šæƒé‡è¡°å‡å› å­ï¼Œç”¨äºæ§åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚é»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºä¸ä½¿ç”¨æƒé‡è¡°å‡ã€‚</li><li><code>nesterov</code>ï¼šæ˜¯å¦ä½¿ç”¨ Nesterov åŠ é€Ÿæ¢¯åº¦ï¼Œå³ä½¿ç”¨å½“å‰ä½ç½®çš„åŠ¨é‡é¡¹è¿›è¡Œæ¢¯åº¦ä¼°è®¡ï¼Œå¯ä»¥æé«˜ä¼˜åŒ–æ•ˆæœã€‚é»˜è®¤å€¼ä¸º Falseã€‚</li></ul><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç»™å‡ºäº†å¦‚ä½•ä½¿ç”¨ <code>torch.optim.SGD</code> å°†æ¨¡å‹çš„æƒé‡å‘é‡ w è¿›è¡Œéšæœºæ¢¯åº¦ä¸‹é™æ›´æ–°ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.optim </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> optim</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">model </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> MyModel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">optimizer </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> optim.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">SGD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(model.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">parameters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">lr</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.01</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">momentum</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> inputs, labels </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> data_loader:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    optimizer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">zero_grad</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    loss </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> loss_fn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">model</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(inputs), labels)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    loss.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">backward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    optimizer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">step</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªæ¨¡å‹ <code>MyModel</code>ï¼Œç„¶åä½¿ç”¨ <code>model.parameters()</code> è·å–æ¨¡å‹çš„å‚æ•°ï¼Œä¼ å…¥ <code>optim.SGD()</code> å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ª <code>SGD</code> ä¼˜åŒ–å™¨å¯¹è±¡ <code>optimizer</code>ã€‚åœ¨æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>optimizer.zero_grad()</code> æ¥æ¸…ç©ºå†å²æ¢¯åº¦ï¼Œç„¶åè¿›è¡Œå‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ï¼Œæœ€åé€šè¿‡ <code>optimizer.step()</code> æ¥æ›´æ–°æ¨¡å‹çš„å‚æ•°ã€‚</p><h2 id="ä¸‰ã€ç½‘ç»œå±‚ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç½‘ç»œå±‚ç»“æ„"><span>ä¸‰ã€ç½‘ç»œå±‚ç»“æ„</span></a></h2><h3 id="_1-å±•å¹³å±‚" tabindex="-1"><a class="header-anchor" href="#_1-å±•å¹³å±‚"><span>1. å±•å¹³å±‚</span></a></h3><p><code>nn.Flatten()</code> æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªå±‚ï¼ˆlayerï¼‰ï¼Œç”¨äºå°†è¾“å…¥å¼ é‡å±•å¹³æˆä¸€ä¸ªå‘é‡ï¼Œä¾‹å¦‚å°†ä¸€ä¸ªå¤§å°ä¸º <code>(n, c, h, w)</code> çš„å››ç»´å¼ é‡å±•å¹³ä¸ºä¸€ä¸ªå¤§å°ä¸º <code>(n, c*h*w)</code> çš„äºŒç»´å¼ é‡ã€‚</p><p>è¿™ä¸ªæ“ä½œåœ¨ç¥ç»ç½‘ç»œä¸­ç»å¸¸ç”¨åˆ°ï¼Œé€šå¸¸å‡ºç°åœ¨å·ç§¯å’Œæ± åŒ–å±‚åä»¥ä¾¿å°†å…¶è¾“å‡ºè¿›å…¥å…¨è¿æ¥å±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå½“å·ç§¯å’Œæ± åŒ–å±‚çš„è¾“å‡ºä¸ºå››ç»´å¼ é‡ï¼Œè€Œå…¨è¿æ¥å±‚çš„è¾“å…¥ä¸ºäºŒç»´å¼ é‡æ—¶ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ <code>nn.Flatten()</code> æ¥å°†å¼ é‡å±•å¹³ä¸ºä¸€ä¸ªå‘é‡ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>nn.Flatten()</code>ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">model </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Sequential</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Conv2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">in_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">out_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">kernel_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">padding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">ReLU</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">MaxPool2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">kernel_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Conv2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">in_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">out_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">kernel_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">padding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">ReLU</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">MaxPool2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">kernel_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Flatten</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Linear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">in_features</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">out_features</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ CNN æ¨¡å‹ï¼Œå…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªå·ç§¯å±‚ã€ä¸¤ä¸ª ReLU æ¿€æ´»å±‚å’Œä¸¤ä¸ª MaxPool å±‚ã€‚è¿™äº›å±‚çš„è¾“å‡ºéƒ½æ˜¯å››ç»´å¼ é‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨æœ€åä¸€ä¸ª MaxPool2d å±‚ä¹‹åä½¿ç”¨ <code>nn.Flatten()</code> å±‚å°†è¾“å‡ºå¼ é‡å±•å¹³æˆäºŒç»´å¼ é‡ï¼Œç„¶åæ‰èƒ½è¿›å…¥å…¨è¿æ¥å±‚è¿›è¡Œåˆ†ç±»ã€‚</p><h3 id="_2-å·ç§¯å±‚" tabindex="-1"><a class="header-anchor" href="#_2-å·ç§¯å±‚"><span>2. å·ç§¯å±‚</span></a></h3><p><code>nn.Conv2d</code>æ˜¯ PyTorch ä¸­ç”¨äºå®šä¹‰äºŒç»´å·ç§¯å±‚çš„å‡½æ•°ã€‚å®ƒæ˜¯åŸºäº torch.nn.Module æ„é€ å‡ºçš„ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ PyTorch æä¾›çš„ API è¿›è¡Œè°ƒç”¨ï¼Œå…¶ä¸»è¦å‚æ•°åŒ…æ‹¬ï¼šè¾“å…¥é€šé“æ•°ï¼Œè¾“å‡ºé€šé“æ•°ï¼Œå·ç§¯æ ¸å¤§å°ï¼Œæ­¥é•¿ã€å¡«å……ç­‰ã€‚å½“å®šä¹‰äº†å·ç§¯å±‚åï¼Œéœ€è¦è°ƒç”¨ forward å‡½æ•°è®¡ç®—è¾“å‡ºå€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ nn.Conv2d å®šä¹‰å·ç§¯å±‚çš„ç®€å•ç¤ºä¾‹ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å®šä¹‰å·ç§¯å±‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">conv_layer </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Conv2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">in_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">out_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">kernel_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">stride</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">padding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å‡è®¾è¾“å…¥ä¸€ä¸ªå¤§å°ä¸º [batch_size, 3, 28, 28] çš„å¼ é‡ x</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">28</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">28</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è®¡ç®—å·ç§¯å±‚è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> conv_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¾“å‡ºç»“æœçš„å¤§å°: [batch_size, 64, 28, 28]</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(output.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span></code></pre></div><p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªè¾“å…¥é€šé“æ•°ä¸º 3ï¼Œè¾“å‡ºé€šé“æ•°ä¸º 64ï¼Œå·ç§¯æ ¸å¤§å°ä¸º 3x3ï¼Œæ­¥é•¿ã€å¡«å……å‡ä¸º 1 çš„å·ç§¯å±‚ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°ä¸€ä¸ªå¤§å°ä¸º[16, 3, 28, 28]çš„å¼ é‡ä¸Šï¼Œç„¶åè¾“å‡ºçš„ç»“æœå¤§å°æ˜¯[16, 64, 28, 28]ï¼Œå…¶ä¸­ 16 æ˜¯ batch_size çš„å¤§å°ã€‚</p><h3 id="_3-æ± åŒ–å±‚" tabindex="-1"><a class="header-anchor" href="#_3-æ± åŒ–å±‚"><span>3. æ± åŒ–å±‚</span></a></h3><blockquote><p><code>nn.MaxPool2d</code></p></blockquote><p><code>nn.MaxPool2d</code>æ˜¯ PyTorch ç¥ç»ç½‘ç»œåº“ä¸­æä¾›çš„æœ€å¤§æ± åŒ–å±‚ã€‚å®ƒå¯ä»¥åœ¨è¾“å…¥ä¸Šæ‰§è¡Œ 2D æœ€å¤§æ± åŒ–æ“ä½œï¼Œå°†è¾“å…¥åˆ’åˆ†ä¸ºå›ºå®šçš„æ± åŒ–åŒºåŸŸï¼Œå¹¶åœ¨æ¯ä¸ªæ± åŒ–åŒºåŸŸå†…æ‰¾åˆ°æœ€å¤§å€¼ã€‚å…·ä½“è€Œè¨€ï¼ŒMaxPool2d çš„ä½œç”¨æ˜¯å°†è¾“å…¥å¼ é‡åœ¨æ¯ä¸ªæ± åŒ–çª—å£å†…å–æœ€å¤§å€¼ï¼Œå¹¶å°†æ‰€æœ‰ç»“æœç»„åˆæˆä¸€ä¸ªå¼ é‡ï¼Œä½œä¸ºè¾“å‡ºã€‚</p><p>è¯¥å‡½æ•°æœ‰ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><code>kernel_size</code>: æ± åŒ–çª—å£çš„å¤§å°ï¼ˆå®½åº¦ï¼Œé«˜åº¦ï¼‰ã€‚</li><li><code>stride</code>ï¼š æ± åŒ–çª—å£çš„ç§»åŠ¨æ­¥é•¿ã€‚</li><li><code>padding</code>ï¼šå¯¹é«˜åº¦å’Œå®½åº¦çš„é›¶å¡«å……æ•°é‡</li><li><code>dilation</code>: æ§åˆ¶æ»¤æ³¢å™¨å…ƒç´ ä¹‹é—´è·ç¦»çš„å‚æ•°ã€‚</li><li><code>return_indices</code>ï¼šè¿”å›ç”±æœ€å¤§å€¼ç»„æˆçš„å¼ é‡çš„ä½ç½®çš„æŒ‡æ ‡ï¼Œè€Œä¸æ˜¯æœ€å¤§å€¼æœ¬èº«ã€‚</li><li><code>ceil_mode</code>ï¼šæ˜¯å¦è¾“å‡ºå›¾åƒå¤§å°å‘ä¸Šå–æ•´</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Define a 2D max pooling layer</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">maxpool_layer </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">MaxPool2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">kernel_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">stride</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Apply max pooling to an input tensor</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">input_tensor </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output_tensor </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> maxpool_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(input_tensor)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Input shape: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">input_tensor.shape</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Output shape: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output_tensor.shape</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª kernel å¤§å°ä¸º 2 * 2ï¼Œæ­¥å¹…ä¸º 2 çš„ 2D æœ€å¤§æ± åŒ–å±‚ï¼Œå¹¶å°†è¯¥å±‚åº”ç”¨äºä¸€ä¸ªå¼ é‡ã€‚è¾“å…¥å¼ é‡çš„å½¢çŠ¶ä¸ºï¼ˆ1ï¼Œ3ï¼Œ4ï¼Œ4ï¼‰ï¼Œå…¶ä¸­ 1 è¡¨ç¤ºæ‰¹æ¬¡å¤§å°ï¼Œ3 è¡¨ç¤ºé€šé“æ•°ï¼Œ4 å’Œ 4 è¡¨ç¤ºè¾“å…¥å›¾åƒçš„å®½åº¦å’Œé«˜åº¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMaxPool2d çš„è¾“å‡ºå¼ é‡å½¢çŠ¶ä¸ºï¼ˆ1ï¼Œ3ï¼Œ2ï¼Œ2ï¼‰ï¼Œå› ä¸ºçª—å£ä¸­çš„ 4 ä¸ªæ± åŒ–åŒºåŸŸä¸­çš„æ¯ä¸ªéƒ½æœ‰ä¸€ä¸ªè¾“å‡ºå€¼ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¸ä½¿ç”¨å…¶ä»–å‚æ•°ï¼Œå› æ­¤é»˜è®¤å‚æ•°è¢«ç”¨åˆ°ã€‚</p><hr><blockquote><p><code>nn.AdaptiveAvgPool2d</code></p></blockquote><p><code>nn.AdaptiveAvgPool2d</code>æ˜¯ PyTorch ç¥ç»ç½‘ç»œåº“ä¸­æä¾›çš„è‡ªé€‚åº”å¹³å‡æ± åŒ–å±‚ã€‚å®ƒå¯¹è¾“å…¥è¿›è¡ŒäºŒç»´å¹³å‡æ± åŒ–ï¼Œä½¿è¾“å‡ºå…·æœ‰ç‰¹å®šå½¢çŠ¶ã€‚å®ƒå¯ä»¥è‡ªé€‚åº”åœ°è€ƒè™‘æ›´å¤§æˆ–æ›´å°çš„è¾“å…¥å¼ é‡ï¼Œå¹¶æ ¹æ®æŒ‡å®šçš„è¾“å‡ºå¤§å°è°ƒæ•´çª—å£å¤§å°å’Œæ­¥å¹…ï¼Œä»¥ä½¿è¾“å‡ºå…·æœ‰æœŸæœ›çš„å¤§å°ã€‚</p><p>è¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå¿…é¡»çš„å‚æ•°è¾“å‡ºå¤§å°ï¼ˆoutput_sizeï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›è¾“å‡ºçš„å¼ é‡å¤§å°ä¸ºï¼ˆbatch_sizeï¼Œchannelï¼Œoutput_sizeï¼Œoutput_sizeï¼‰</p><p><code>nn.AdaptiveAvgPool2d</code>çš„è¾“å‡ºå¼ é‡å½¢çŠ¶ä¸ºæŒ‡å®šå¤§å°çš„è¾“å‡ºï¼Œæ— è®ºè¾“å…¥å¼ é‡çš„å°ºå¯¸å¦‚ä½•ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒæ•´çª—å£å¤§å°å’Œæ­¥å¹…ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Define a 2D adaptive average pooling layer</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">adaptive_avg_pool_layer </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">AdaptiveAvgPool2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">output_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Apply adaptive average pooling to an input tensor</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">input_tensor </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output_tensor </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> adaptive_avg_pool_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(input_tensor)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Input shape: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">input_tensor.shape</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Output shape: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output_tensor.shape</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª 2D è‡ªé€‚åº”å¹³å‡æ± åŒ–å±‚ï¼Œå¹¶å°†å…¶åº”ç”¨äºä¸€ä¸ªè¾“å…¥å¼ é‡ã€‚è¾“å…¥å¼ é‡çš„å½¢çŠ¶ä¸ºï¼ˆ1ï¼Œ3ï¼Œ4ï¼Œ4ï¼‰ï¼Œå…¶ä¸­ 1 è¡¨ç¤ºæ‰¹æ¬¡å¤§å°ï¼Œ3 è¡¨ç¤ºé€šé“æ•°ï¼Œ4 å’Œ 4 è¡¨ç¤ºè¾“å…¥å›¾åƒçš„å®½åº¦å’Œé«˜åº¦ã€‚ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œè¾“å‡ºå¤§å°ä¸ºï¼ˆ2,2ï¼‰ï¼Œå› æ­¤è¾“å‡ºå¼ é‡çš„å½¢çŠ¶ä¸ºï¼ˆ1ï¼Œ3ï¼Œ2ï¼Œ2ï¼‰ã€‚</p><h3 id="_4-dropout" tabindex="-1"><a class="header-anchor" href="#_4-dropout"><span>4. Dropout</span></a></h3><p><code>dropout</code>æ˜¯ä¸€ç§å¸¸ç”¨çš„æ­£åˆ™åŒ–æ–¹æ³•ç”¨äºå‡å°‘ç¥ç»ç½‘ç»œçš„è¿‡æ‹Ÿåˆé£é™©ã€‚ åœ¨è¿è¡Œæ—¶æœŸé—´ï¼Œ<code>dropout</code>ä»¥ä¸€å®šçš„æ¦‚ç‡ä¸¢å¼ƒï¼ˆè®¾ç½®äº 0ï¼‰è¾“å…¥å•å…ƒæˆ–è¾“å‡ºå•å…ƒçš„æƒé‡ï¼Œç„¶åä»è®­ç»ƒæ•°æ®é›†çš„å°æ‰¹é‡æ•°æ®ä¸­éšæœºé€‰æ‹©æ–°çš„è¾“å…¥å•å…ƒæˆ–è¾“å‡ºå•å…ƒçš„æƒé‡ã€‚ è¿‡æ‹Ÿåˆé£é™©è¾ƒå¤§çš„ç¥ç»å…ƒå°†ä¼šæœ‰è¾ƒå¤§çš„æ¦‚ç‡è¢«ä¸¢å¼ƒï¼Œä¿ç•™è¾ƒå°çš„æ¦‚ç‡ï¼Œä»¥å‡è½»ç¥ç»å…ƒä¹‹é—´çš„å¤æ‚ååŒå…³ç³»ã€‚</p><p>åœ¨æ·±åº¦å­¦ä¹ ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œ<code>dropout</code>å±‚ä¸€èˆ¬åŠ åœ¨å…¨è¿æ¥å±‚ä¹‹åï¼Œå¯ä»¥é€šè¿‡<code>nn.Dropout(p = probability)</code>ç›´æ¥å®ç°ã€‚p ä¸ºä¸¢å¼ƒçš„æ¦‚ç‡ï¼Œé€šå¸¸å– 0.2~0.5 ä¹‹é—´çš„å€¼ã€‚</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">dropout </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Dropout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><h3 id="_5-batchnorm" tabindex="-1"><a class="header-anchor" href="#_5-batchnorm"><span>5. BatchNorm</span></a></h3><p><code>nn.BatchNorm2d</code>æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªæ‰¹é‡å½’ä¸€åŒ–ï¼ˆBatch Normalizationï¼‰æ“ä½œç±»ã€‚å®ƒä¼šå¯¹è¾“å…¥è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œè®©å‰ä¸€å±‚çš„è¾“å‡ºå…¶å‡å€¼ä¸º 0ï¼Œæ–¹å·®ä¸º 1ï¼Œå¹¶é€šè¿‡å¯å­¦ä¹ çš„ç¼©æ”¾å’Œåç§»å‚æ•°ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ¢å¤ä»»æ„çš„å˜æ¢ã€‚</p><p>è¯¥ç±»çš„ä¸»è¦å‚æ•°åŒ…æ‹¬ï¼š</p><ul><li><code>num_features</code>ï¼šè¾“å…¥ç‰¹å¾çš„é€šé“æ•°ã€‚</li><li><code>eps</code>ï¼šä¸ºäº†é¿å…åˆ†æ¯ä¸ºé›¶çš„æƒ…å†µï¼Œåœ¨åˆ†æ¯ä¸ŠåŠ ä¸Šä¸€ä¸ªå¾ˆå°çš„æ•° epsã€‚</li><li><code>momentum</code>ï¼šç”¨äºè®¡ç®—ç§»åŠ¨å¹³å‡å€¼çš„åŠ¨é‡ç³»æ•°ï¼Œç”¨äºæ›´æ–°æ±‚å¾—çš„å‡å€¼å’Œæ–¹å·®ã€‚</li><li><code>affine</code>: bool ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º Trueï¼Œè¡¨ç¤ºæ˜¯å¦å¯ç”¨å¯å­¦ä¹ çš„ç¼©æ”¾å’Œå¹³ç§»å‚æ•°ã€‚</li><li><code>track_running_stats</code>: bool ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º Trueï¼Œè¡¨ç¤ºæ˜¯å¦ä½¿ç”¨è¿è¡Œç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚å¹³å‡å€¼å’Œæ ‡å‡†å·®ï¼‰æ¥æ ‡å‡†åŒ–ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨å®ä¾‹ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åˆå§‹åŒ–ä¸€ä¸ª BatchNorm2d</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">bn </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">BatchNorm2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">num_features</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">input</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> bn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.shape)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(output.shape)</span></span></code></pre></div><p>è¯¥ä¾‹å­ä¸­ï¼Œ<code>num_features</code>è¢«è®¾ç½®ä¸º 3ï¼Œè¡¨ç¤ºè¾“å…¥ç‰¹å¾çš„é€šé“æ•°ä¸º 3ã€‚è¾“å…¥çš„å¼ é‡<code>input</code>çš„å½¢çŠ¶ä¸º(2, 3, 4, 4)ï¼Œè¡¨ç¤º batch_size ä¸º 2ï¼Œé€šé“æ•°ä¸º 3ï¼Œæ¯ä¸ªç‰¹å¾å›¾çš„å¤§å°ä¸º(4, 4)ã€‚æ‰§è¡Œ<code>bn(input)</code>åï¼Œè¿”å›çš„è¾“å‡ºå¼ é‡<code>output</code>å…·æœ‰ç›¸åŒçš„å½¢çŠ¶ã€‚</p><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œ<code>BatchNorm2d</code> å¯¹æ¥æ”¶åˆ°çš„æ¯ä¸ª <code>feature map</code> åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ol><li>è®¡ç®—æ¯ä¸ª feature map çš„å‡å€¼å’Œæ–¹å·®ï¼Œå¹¶é€šè¿‡ç§»åŠ¨å¹³å‡çš„æ–¹å¼æ•´åˆåˆ°å…¨å±€å‡å€¼å’Œæ–¹å·®ä¸­ã€‚</li><li>æ ¹æ®ä¸Šè¿°çš„å‡å€¼å’Œæ–¹å·®ï¼Œå¯¹ feature map è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€‚</li><li>é€šè¿‡å¯å­¦ä¹ çš„ç¼©æ”¾å’Œåç§»å‚æ•°è¿›è¡Œçº¿æ€§å˜æ¢ã€‚</li><li>è¿”å›æ ‡å‡†åŒ–åçš„ feature mapã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æµ‹è¯•æ¨¡å¼ä¸‹ï¼ŒBatchNorm2d çš„è¿ä½œæ–¹å¼ä¸è®­ç»ƒæ¨¡å¼ä¸åŒï¼Œå…¶å‰å‘ä¼ æ’­ä¸ä¼šä½¿ç”¨ mini-batch çš„å‡å€¼å’Œæ–¹å·®ï¼Œè€Œæ˜¯ä½¿ç”¨å…¨å±€çš„å‡å€¼å’Œæ–¹å·®ï¼ˆåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€šè¿‡åŠ¨é‡æ–¹å¼ç´¯ç§¯å¾—åˆ°çš„å‡å€¼å’Œæ–¹å·®ï¼‰æ¥è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€‚</p><h3 id="_6-relu" tabindex="-1"><a class="header-anchor" href="#_6-relu"><span>6. Relu</span></a></h3><p><code>nn.ReLU</code>æ˜¯å¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œä¿®æ­£çº¿æ€§å•å…ƒ(Rectified Linear Units, ReLU)æ“ä½œçš„ç±»ã€‚ReLU æ˜¯æ·±åº¦å­¦ä¹ ä¸­å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ï¼Œå®ƒå¯ä»¥é€šè¿‡å°†è´Ÿå€¼å˜ä¸º 0 æ¥å¢å¼ºçº¿æ€§ç¥ç»ç½‘ç»œçš„éçº¿æ€§æ€§ã€‚å…¶ä»£æ•°å¼ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x) = max(0,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ï¼Œå³å½“è¾“å…¥ x å¤§äº 0 æ—¶<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ç­‰äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>ï¼Œå¦åˆ™<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ç­‰äº 0ã€‚</p><p><code>nn.ReLU</code>çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå®ƒæ¥æ”¶è¾“å…¥å¼ é‡å¹¶å°†å…¶ä½œç”¨äº ReLU æ¿€æ´»å‡½æ•°ï¼Œè¾“å‡º ReLU æ¿€æ´»åçš„å¼ é‡ã€‚åœ¨ pytorch ä¸­ä½¿ç”¨<code>nn.ReLU</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">relu </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">ReLU</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> relu</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><p>å…¶ä¸­<code>input</code>æ˜¯è¾“å…¥å¼ é‡ï¼Œ<code>output</code>æ˜¯ç»è¿‡ ReLU æ¿€æ´»åçš„è¾“å‡ºå¼ é‡ã€‚</p><blockquote><p><code>nn.ReLU(inplace=True)</code></p></blockquote><p><code>nn.ReLU(inplace=True)</code>ä¸<code>nn.ReLU()</code>çš„åŒºåˆ«åœ¨äºï¼Œå®ƒå°†åŸåœ°ä¿®æ”¹è¾“å…¥å¼ é‡è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¼ é‡ä½œä¸ºè¾“å‡ºï¼Œå¹¶è¿”å›å·²ä¿®æ”¹çš„è¾“å…¥å¼ é‡ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œä½¿ç”¨<code>nn.ReLU(inplace=True)</code>ä¼šçœç•¥å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œå› ä¸ºä¸ä¼šäº§ç”Ÿæ–°çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å†…å­˜å¼€é”€ï¼Œå› ä¸ºæ¯æ¬¡å†…å­˜åˆ†é…å’Œé‡Šæ”¾éƒ½éœ€è¦æ¶ˆè€—å¤§é‡çš„æ—¶é—´å’Œèµ„æºã€‚åŒæ—¶ï¼Œä½¿ç”¨ inplace çš„æ“ä½œè¿˜å¯ä»¥æé«˜è®¡ç®—æ€§èƒ½ï¼Œå› ä¸ºä¸éœ€è¦å°†æ•°æ®ä»ä¸€ä¸ªä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨<code>inplace=True</code>æœ‰æ—¶ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„ç»“æœæˆ–è€…æ¢¯åº¦è®¡ç®—çš„é”™è¯¯ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦è°¨æ…ï¼Œå¹¶æ ¹æ®å…·ä½“æƒ…å†µåˆ¤æ–­æ˜¯å¦éœ€è¦å¼€å¯ inplace æ¨¡å¼ã€‚</p><p><code>nn.ReLU</code>å¯èƒ½å­˜åœ¨çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼š</p><ol><li>æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸ï¼šå½“è¾“å…¥å¾ˆå¤§æˆ–å¾ˆå°çš„æ—¶å€™ï¼ŒReLU çš„å¯¼æ•°ä¼šå˜æˆ 0 æˆ–æ— ç©·å¤§ï¼Œä»è€Œå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸çš„é—®é¢˜ã€‚</li><li>ç¥ç»å…ƒæ­»äº¡ï¼šå¦‚æœè®­ç»ƒæœŸé—´ä¸€ä¸ª ReLU ç¥ç»å…ƒè¢«æ›´æ–°æˆä¸€ç›´è¾“å‡º 0 çš„çŠ¶æ€ï¼Œé‚£ä¹ˆåœ¨ä»¥åçš„è®­ç»ƒè¿‡ç¨‹ä¸­è¯¥ç¥ç»å…ƒçš„å‚æ•°å°†ä¸€ç›´ä¿æŒä¸å˜ï¼Œä¹Ÿå°±æ˜¯è¢«&quot;æ­»äº¡&quot;äº†ã€‚è¿™ç§æƒ…å†µçš„å‘ç”Ÿé€šå¸¸ä¸å­¦ä¹ ç‡è¿‡é«˜æœ‰å…³ï¼Œå¯ä»¥é€šè¿‡å‡å°å­¦ä¹ ç‡æˆ–ä½¿ç”¨å…¶ä»–æ¿€æ´»å‡½æ•°æ¥ç¼“è§£ã€‚</li></ol><h3 id="_7-åå·ç§¯å±‚" tabindex="-1"><a class="header-anchor" href="#_7-åå·ç§¯å±‚"><span>7. åå·ç§¯å±‚</span></a></h3><p><code>nn.ConvTranspose2d</code> æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªå·ç§¯è½¬ç½®å±‚ï¼Œç”¨äºè¿›è¡Œåå·ç§¯ï¼ˆDeconvolutionï¼‰æ“ä½œã€‚å®ƒçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªä½ç»´çš„ç‰¹å¾å›¾æ˜ å°„åˆ°ä¸€ä¸ªé«˜ç»´ç©ºé—´ä¸­ï¼Œå¯ä»¥ç”¨äºå›¾åƒåˆ†å‰²ã€è¯­ä¹‰åˆ†å‰²ã€è¶…åˆ†è¾¨ç‡ç­‰ä»»åŠ¡ã€‚</p><p>åœ¨å…·ä½“å®ç°ä¸­ï¼Œ<code>nn.ConvTranspose2d</code> ä¸ <code>nn.Conv2d</code> çš„å®ç°æ–¹å¼ååˆ†ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å·ç§¯æ ¸ä¸è¾“å…¥çš„ç‰¹å¾å›¾è¿›è¡Œå·ç§¯æ“ä½œï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸»è¦çš„åŒºåˆ«åœ¨äºåå·ç§¯æ“ä½œæ˜¯å°†å·ç§¯æ ¸ä¸­çš„å€¼è¿›è¡Œä¸Šé‡‡æ ·ä¹‹åè¿›è¡Œå·ç§¯ï¼Œä»è€Œå®ç°ç‰¹å¾å›¾çš„ä¸Šé‡‡æ ·ï¼Œå¯¹åº”äºå·ç§¯æ“ä½œä¸­çš„ä¸‹é‡‡æ ·ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ <code>nn.ConvTranspose2d(in_channels, out_channels, kernel_size, stride=1, padding=0, output_padding=0, groups=1, bias=True, dilation=1)</code> çš„å‚æ•°å«ä¹‰ä»‹ç»å¦‚ä¸‹ï¼š</p><ul><li><code>in_channels</code> : è¾“å…¥ç‰¹å¾å›¾çš„é€šé“æ•°ã€‚</li><li><code>out_channels</code> : è¾“å‡ºç‰¹å¾å›¾çš„é€šé“æ•°ã€‚</li><li><code>kernel_size</code> : å·ç§¯æ ¸çš„å¤§å°ã€‚</li><li><code>stride</code> : æ­¥é•¿ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚</li><li><code>padding</code> : å¡«å……å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚</li><li><code>output_padding</code> : è¾“å‡ºç‰¹å¾å›¾å¡«å……å¤§å°ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚</li><li><code>groups</code> : ç»„æ•°ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚ä¸€ä¸ª ConvTranspose2d è¿æ¥äº†å¤šä¸ªè¾“å…¥é€šé“ç»„å’Œå¤šä¸ªè¾“å‡ºé€šé“ç»„ã€‚</li><li><code>bias</code> : æ˜¯å¦ä½¿ç”¨åç½®ï¼Œé»˜è®¤ä¸º <code>True</code>ã€‚</li><li><code>dilation</code> : å·ç§¯æ ¸çš„è†¨èƒ€ç‡ï¼Œé»˜è®¤ä¸º 1ã€‚</li></ul><p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">conv_trans </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">ConvTranspose2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">in_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">out_channels</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">kernel_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">stride</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">padding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">output_padding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åœ¨è¾“å…¥ç‰¹å¾å›¾ä¸Šè¿›è¡Œåå·ç§¯</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">randn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">output </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> conv_trans</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(output.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¾“å‡ºå½¢çŠ¶ä¸º [1, 64, 25, 25]</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåå·ç§¯å±‚ <code>conv_trans</code>ï¼Œå°†è¾“å…¥é€šé“æ•°è®¾ä¸º 32ï¼Œè¾“å‡ºé€šé“æ•°è®¾ä¸º 64ï¼Œå·ç§¯æ ¸å¤§å°ä¸º (3, 3)ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ PyTorch ä¸­çš„ <code>torch.randn()</code> å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º (1, 32, 12, 12) çš„è¾“å…¥ç‰¹å¾å›¾ï¼Œå…¶ä¸­ 1 è¡¨ç¤º batch_sizeï¼Œ32 è¡¨ç¤ºè¾“å…¥é€šé“æ•°ï¼Œ12 è¡¨ç¤ºç‰¹å¾å›¾é«˜å’Œå®½ã€‚æœ€åï¼Œæˆ‘ä»¬å¯¹è¾“å…¥å›¾åƒåšäº†åå·ç§¯æ“ä½œï¼Œè¾“å‡ºçš„ç‰¹å¾å›¾å¤§å°ä¸º (1, 64, 25, 25)ï¼Œå…¶ä¸­ç‰¹å¾å›¾é«˜å’Œå®½åˆ†åˆ«ä¸º 25ï¼Œå¯ä»¥æ ¹æ®å·ç§¯è½¬ç½®çš„è®¡ç®—å…¬å¼æ¨å¯¼æ¥è¿›è¡Œç†è§£ã€‚</p><h2 id="å››ã€å‚æ•°è®¿é—®" tabindex="-1"><a class="header-anchor" href="#å››ã€å‚æ•°è®¿é—®"><span>å››ã€å‚æ•°è®¿é—®</span></a></h2><h3 id="_1-named-parameters-æˆ–parameters" tabindex="-1"><a class="header-anchor" href="#_1-named-parameters-æˆ–parameters"><span>1. <code>named_parameters()</code>æˆ–<code>parameters()</code></span></a></h3><p>ä½¿ç”¨ model.named_parameters()æˆ– model.parameters()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œéå†æ¯ä¸ªå‚æ•°å¹¶è¿”å›å¯¹åº”çš„å‚æ•°å¼ é‡åŠåç§°ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Net</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">nn</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Module</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(Net, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">__init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.conv1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Conv2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">padding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.fc1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Linear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.fc2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Linear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> forward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">conv1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">view</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">fc1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">fc2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">model </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> Net</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># named_parameters()æ–¹æ³•è·å–ç½‘ç»œå±‚å‚æ•°åŠåç§°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> name, param </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> model.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">named_parameters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">     print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(name, param.data.shape)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>model.named_parameters</code>è®¿é—®çš„æ˜¯æ‰€æœ‰å±‚çš„å‚æ•°ï¼Œè¦æƒ³è®¿é—®å…·ä½“æŸä¸€å±‚çš„å‚æ•°ï¼Œåªéœ€è¦<code>model.(å±‚name).named_parameters</code>.</p></blockquote><h3 id="_2-model-layer-weight" tabindex="-1"><a class="header-anchor" href="#_2-model-layer-weight"><span>2. <code>model.layer.weight</code></span></a></h3><p>ä½¿ç”¨<code>model.layer.weight</code>å’Œ<code>model.layer.bias</code>ç›´æ¥è·å–æŸä¸€å±‚çš„æƒé‡å’Œåç½®ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Net</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">nn</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Module</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(Net, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">__init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.layer </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Linear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> forward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">model </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> Net</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ç›´æ¥è®¿é—®moduleçš„æˆå‘˜å˜é‡è·å–ç½‘ç»œå±‚å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">weight </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> model.layer.weight.data</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">bias </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> model.layer.bias.data</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(weight, bias)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç›´æ¥ä½¿ç”¨<code>model.layer.weight</code>ï¼Œè¿”å›å€¼é™¤äº†å€¼å¤–ï¼Œè¿˜åŒ…æ‹¬æ¢¯åº¦ç­‰é¢å¤–ä¿¡æ¯ã€‚</li></ul><h3 id="_3-state-dict" tabindex="-1"><a class="header-anchor" href="#_3-state-dict"><span>3. <code>state_dict</code></span></a></h3><p>ä½¿ç”¨ model.state_dict()æ–¹æ³•è·å–ç½‘ç»œå±‚çš„å‚æ•°å­—å…¸ï¼Œè¯¥å­—å…¸åŒ…å«æ¯ä¸ªå±‚çš„åç§°å’Œå‚æ•°ï¼Œä¾‹å¦‚<code>model.state_dict()[&#39;layer.weight&#39;]</code>ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Net</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">nn</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Module</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(Net, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">__init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.layer </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Linear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> forward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        x </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> x</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">model </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> Net</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># state_dictæ–¹æ³•è·å–ç½‘ç»œå±‚å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">params_dict </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> model.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">state_dict</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">weight </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> params_dict[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;layer.weight&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">bias </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> params_dict[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;layer.bias&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(weight, bias)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ä¸‹é¢æ˜¯<code>state_dict()</code>è¿”å›çš„ç»“æœæ ·ä¾‹</p></blockquote><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">OrderedDict</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;weight&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">tensor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([[ </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.3016</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.1901</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.1991</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.1220</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.1121</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.1424</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.3060</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.3400</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]])), (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;bias&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">tensor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.0291</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]))])</span></span></code></pre></div><h2 id="äº”ã€ä¿å­˜å’Œè¯»å–æ¨¡å‹å‚æ•°" tabindex="-1"><a class="header-anchor" href="#äº”ã€ä¿å­˜å’Œè¯»å–æ¨¡å‹å‚æ•°"><span>äº”ã€ä¿å­˜å’Œè¯»å–æ¨¡å‹å‚æ•°</span></a></h2><h3 id="_1-ä¿å­˜å’Œè¯»å–" tabindex="-1"><a class="header-anchor" href="#_1-ä¿å­˜å’Œè¯»å–"><span>1. ä¿å­˜å’Œè¯»å–</span></a></h3><p>PyTorch ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>state_dict</code> æ¥ä¿å­˜å’Œè¯»å–æ¨¡å‹çš„å‚æ•°ã€‚<code>state_dict</code> æ˜¯ä¸€ä¸ª Python å­—å…¸å¯¹è±¡ï¼Œå®ƒå°†æ¯ä¸ªå±‚æ˜ å°„åˆ°å…¶å‚æ•°å¼ é‡ã€‚å¯ä»¥å°† <code>state_dict</code> å­˜å‚¨ä¸ºæ–‡ä»¶ä»¥å¤‡ä»¥åä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä½œä¸º Python å¯¹è±¡ä¼ é€’ç»™å…¶ä»– PyTorch æ¨¡å‹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä¿å­˜å’Œè¯»å–æ¨¡å‹å‚æ•°ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.nn </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å®šä¹‰æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyModel</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">nn</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Module</span><span style="--shiki-light:#C18401;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> __init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(MyModel, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">__init__</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.linear </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Linear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> forward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">linear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">model </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> MyModel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¿å­˜æ¨¡å‹å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(model.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">state_dict</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;model_params.pth&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åŠ è½½æ¨¡å‹å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">model.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">load_state_dict</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">load</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;model_params.pth&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„æ¨¡å‹ <code>MyModel</code>ï¼Œå®ƒåŒ…å«ä¸€ä¸ªçº¿æ€§å±‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>torch.save</code> å‡½æ•°ï¼Œå°†æ¨¡å‹çš„ <code>state_dict</code> ä¿å­˜åˆ°åä¸º <code>&#39;model_params.pth&#39;</code> çš„æ–‡ä»¶ä¸­ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>torch.load</code> å‡½æ•°åŠ è½½ä¿å­˜çš„ <code>state_dict</code>ã€‚ç„¶åè°ƒç”¨ <code>model.load_state_dict</code> å°†åŠ è½½çš„ <code>state_dict</code> ä¼ é€’ç»™æ¨¡å‹ã€‚è¿™å°†æ›´æ–°æ¨¡å‹çš„å‚æ•°ã€‚</p><p>PyTorch ä¹Ÿæ”¯æŒ <code>save</code> å’Œ <code>load</code> å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å°†æ•´ä¸ªæ¨¡å‹ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶æ”¯æŒåœ¨ Python å’Œ C++ ä¸­åŠ è½½æ¨¡å‹ã€‚è¿™äº›å‡½æ•°åœ¨å¤„ç†å¤šä¸ªå¯¹è±¡æ—¶æ›´å…·æœ‰çµæ´»æ€§ï¼Œä½† <code>state_dict</code> æ›´é€‚ç”¨äºä¿å­˜å’ŒåŠ è½½æ¨¡å‹å‚æ•°ã€‚</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mydict </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;x&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: x, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;y&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: y}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(mydict, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;mydict&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mydict2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">load</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;mydict&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mydict2</span></span></code></pre></div><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;x&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">tensor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]), </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;y&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">tensor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">., </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">., </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">., </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.])}</span></span></code></pre></div><h3 id="_2-æŸ¥çœ‹æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-æŸ¥çœ‹æ•°æ®ç»“æ„"><span>2. æŸ¥çœ‹æ•°æ®ç»“æ„</span></a></h3><p>ä½¿ç”¨ torch.save()å‡½æ•°ä¿å­˜çš„æ¨¡å‹æƒé‡å‚æ•°æ–‡ä»¶é»˜è®¤æ˜¯ä»¥ Python çš„ pickle æ ¼å¼è¿›è¡Œåºåˆ—åŒ–çš„ï¼ŒåŒ…æ‹¬ datasets ä¸­æ•°æ®é›†é»˜è®¤ä¹Ÿæ˜¯ä»¥è¿™ç§æ–¹å¼è¿›è¡Œçš„å­˜å‚¨ï¼Œè¿™ç§æ–‡ä»¶ç›´æ¥ä½¿ç”¨æ–‡æœ¬æ‰“å¼€ä¼šæ˜¾ç¤ºä¹±ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ pickle å¯¹æ–‡ä»¶è¿›è¡Œååºåˆ—åŒ–ï¼Œä»¥æŸ¥çœ‹å…¶æ•°æ®ç»“æ„ï¼š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pickle</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">filename </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;../cifar10/cifar-10-batches-py/test_batch&#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> open</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(filename,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;rb&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> f:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    dataset </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> pickle.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">load</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(f, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;bytes&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(dataset))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># out: &lt;class &#39;dict&#39;&gt;</span></span></code></pre></div><h2 id="å…­ã€gpu-ç›¸å…³" tabindex="-1"><a class="header-anchor" href="#å…­ã€gpu-ç›¸å…³"><span>å…­ã€GPU ç›¸å…³</span></a></h2><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nvidia-smi</span></span></code></pre></div><ul><li>ä½¿ç”¨<code>nvidia-smi</code>å‘½ä»¤æ¥æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯</li></ul><figure><img src="/assets/image-20230329155746146-B91yW8yb.png" alt="image-20230329155746146" tabindex="0" loading="lazy"><figcaption>image-20230329155746146</figcaption></figure><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cpu&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cuda&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cudaå’Œcuda:0ç­‰ä»·</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cuda:1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cuda:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">i</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¸¸ç”¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">device </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;cuda&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.cuda.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">is_available</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;cpu&#39;</span></span></code></pre></div><h3 id="_1-å°†æ¨¡å‹å‚æ•°æ”¾åœ¨-gpu" tabindex="-1"><a class="header-anchor" href="#_1-å°†æ¨¡å‹å‚æ•°æ”¾åœ¨-gpu"><span>1. å°†æ¨¡å‹å‚æ•°æ”¾åœ¨ gpu</span></a></h3><ol><li><p>åœ¨åˆ›å»ºçš„æ—¶å€™æŒ‡å®š device</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">ones</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cuda&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">X</span></span></code></pre></div></li><li><p>ä½¿ç”¨ cuda()å¤åˆ¶</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Z </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> X.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">cuda</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å‚æ•°ä¸ºcudaçš„ç¼–å·</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Z</span></span></code></pre></div></li><li><p>ä½¿ç”¨ to()æŒ‡å®š</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">net </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> net.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cuda&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span></code></pre></div></li></ol><h3 id="_2-åˆ‡æ¢æ¨¡å‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_2-åˆ‡æ¢æ¨¡å‹æ¨¡å¼"><span>2. åˆ‡æ¢æ¨¡å‹æ¨¡å¼</span></a></h3><ul><li>åˆ‡æ¢ï¼š<code>model.train()å’Œmodel.eval()</code></li><li>åˆ¤æ–­ï¼š<code>torch.is_grad_enabled()</code><ul><li>æ£€æŸ¥å½“å‰ PyTorch è®¡ç®—å›¾æ˜¯å¦å¯ç”¨æ¢¯åº¦è®¡ç®—ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœæ¢¯åº¦è®¡ç®—å¯ç”¨ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚</li></ul></li></ul><h2 id="ä¸ƒã€æ³¨æ„åŠ›æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€æ³¨æ„åŠ›æœºåˆ¶"><span>ä¸ƒã€æ³¨æ„åŠ›æœºåˆ¶</span></a></h2><p>çµé•¿ç±»åŠ¨ç‰©çš„è§†è§‰ç³»ç»Ÿæ¥å—äº†å¤§é‡çš„æ„Ÿå®˜è¾“å…¥ï¼Œ è¿™äº›æ„Ÿå®˜è¾“å…¥è¿œè¿œè¶…è¿‡äº†å¤§è„‘èƒ½å¤Ÿå®Œå…¨å¤„ç†çš„ç¨‹åº¦ã€‚ ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰åˆºæ¿€çš„å½±å“éƒ½æ˜¯ç›¸ç­‰çš„ã€‚ æ„è¯†çš„èšé›†å’Œä¸“æ³¨ä½¿çµé•¿ç±»åŠ¨ç‰©èƒ½å¤Ÿåœ¨å¤æ‚çš„è§†è§‰ç¯å¢ƒä¸­å°†æ³¨æ„åŠ›å¼•å‘æ„Ÿå…´è¶£çš„ç‰©ä½“ï¼Œä¾‹å¦‚çŒç‰©å’Œå¤©æ•Œã€‚ åªå…³æ³¨ä¸€å°éƒ¨åˆ†ä¿¡æ¯çš„èƒ½åŠ›å¯¹è¿›åŒ–æ›´åŠ æœ‰æ„ä¹‰ï¼Œä½¿äººç±»å¾—ä»¥ç”Ÿå­˜å’ŒæˆåŠŸã€‚</p><p>åœ¨æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œä¼šä½¿ç”¨åˆ°ä¸‰ä¸ªé‡è¦çš„æ¦‚å¿µï¼šæŸ¥è¯¢(Query)ã€é”®(Keys)å’Œå€¼(Value)ã€‚</p><ul><li><p>æŸ¥è¯¢(Query)ï¼šä»£è¡¨æˆ‘ä»¬è¦å¯¹è¾“å…¥ä¸­çš„å“ªä¸€éƒ¨åˆ†è¿›è¡Œå…³æ³¨å’Œå¤„ç†ï¼Œé€šå¸¸æ˜¯åœ¨è®¡ç®—æ³¨æ„åŠ›æƒé‡æ—¶æ‰€ä¾æ®çš„å‘é‡ã€‚å®ƒæ˜¯é€šè¿‡ä¸Šä¸€æ­¥çš„è¾“å‡ºæ¥è®¡ç®—çš„ï¼Œå…·ä½“çš„è®¡ç®—æ–¹å¼å–å†³äºæ³¨æ„åŠ›æœºåˆ¶çš„ä¸åŒç±»å‹ã€‚</p></li><li><p>é”®(Keys)ï¼šå®ƒæ˜¯ç”¨æ¥è¡¨ç¤ºè¾“å…¥åºåˆ—ä¸­å„ä¸ªä½ç½®çš„ç‰¹å¾çš„å‘é‡ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡å¯¹è¾“å…¥è¿›è¡Œå˜æ¢ï¼ˆå¦‚å…¨è¿æ¥å±‚æˆ–å·ç§¯æ“ä½œï¼‰è·å¾—ã€‚</p></li><li><p>å€¼(Value)ï¼šå®ƒæ˜¯è¾“å…¥åºåˆ—ä¸­çš„å„ä¸ªä½ç½®æ‰€å¯¹åº”çš„å®é™…æ•°å€¼ï¼ˆè®­ç»ƒæ—¶çš„è¾“å‡º yï¼‰ï¼Œæ˜¯æœªç»è¿‡å˜æ¢çš„åŸå§‹è¾“å…¥ã€‚</p></li></ul><p>åœ¨æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬åšçš„å®é™…ä¸Šæ˜¯ä»¥ä¸‹ 3 ä»¶äº‹ï¼š</p><ul><li>é¦–å…ˆå°†æŸ¥è¯¢å‘é‡ä¸é”®å‘é‡è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦æˆ–æ¬§å¼è·ç¦»ï¼ˆè¯„åˆ†å‡½æ•°ï¼‰ <ul><li>è¶Šå°ä»£è¡¨é”®é è¿‘è‡ªå·±æƒ³æŸ¥è¯¢çš„å€¼ï¼Œéšä¹‹è®¡ç®—å‡ºçš„æƒé‡è¶Šå¤§</li></ul></li><li>è¿›è¡Œ softmax æ¿€æ´»åå¾—åˆ°æ³¨æ„åŠ›æƒé‡</li><li>æœ€åå°†æ³¨æ„åŠ›æƒé‡ä¸å€¼å‘é‡è¿›è¡ŒåŠ æƒæ±‚å’Œ</li></ul><p>è¿™ä¸ªæ“ä½œçš„ç›®çš„æ˜¯å¯¹ä¸åŒçš„è¾“å…¥ä½ç½®èµ‹äºˆä¸åŒçš„æƒé‡ï¼Œä½¿å¾—åœ¨å¯¹åºåˆ—è¿›è¡Œå¤„ç†æ—¶ï¼Œå¯¹æœ€ç›¸å…³å’Œæœ€é‡è¦çš„éƒ¨åˆ†ç»™äºˆæ›´å¤§çš„å…³æ³¨å’Œæƒé‡ï¼Œä»è€Œæé«˜åºåˆ—çš„è¡¨ç¤ºèƒ½åŠ›ã€‚</p><figure><img src="/assets/attention-output-CwOucdKr.svg" alt="../_images/attention-output.svg" tabindex="0" loading="lazy"><figcaption>../_images/attention-output.svg</figcaption></figure><h2 id="å…«ã€ä¸€äº›é€šç”¨å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å…«ã€ä¸€äº›é€šç”¨å‡½æ•°"><span>å…«ã€ä¸€äº›é€šç”¨å‡½æ•°</span></a></h2><h3 id="_1-è®­ç»ƒå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_1-è®­ç»ƒå‡½æ•°"><span>1. è®­ç»ƒå‡½æ•°</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> train_ch6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">net</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> train_iter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> test_iter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> num_epochs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> lr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # åˆå§‹åŒ–æƒé‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> init_weights</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(m) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.Linear </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">or</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(m) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.Conv2d:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            nn.init.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">xavier_uniform_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(m.weight)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    net.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">apply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(init_weights)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;training on:&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, device)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    net.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(device)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ä¼˜åŒ–å™¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    optimizer </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.optim.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">SGD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(net.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">parameters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">lr</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">lr)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æŸå¤±å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    loss </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nn.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">CrossEntropyLoss</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    animator </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> Animator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">xlabel</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;epoch&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">xlim</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, num_epochs],</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">                            legend</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;train loss&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;train acc&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;test acc&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    timer, num_batches </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> Timer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">len</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(train_iter) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿­ä»£æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> epoch </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> range</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(num_epochs):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # è®­ç»ƒæŸå¤±ä¹‹å’Œï¼Œè®­ç»ƒå‡†ç¡®ç‡ä¹‹å’Œï¼Œæ ·æœ¬æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        metric </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> Accumulator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        net.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">train</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i, (X, y) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> enumerate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(train_iter):</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            timer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            optimizer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">zero_grad</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            X, y </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> X.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(device), y.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(device)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            y_hat </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> net</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(X)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            l </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> loss</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(y_hat, y)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            l.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">backward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            optimizer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">step</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> torch.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">no_grad</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                metric.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(l </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> X.shape[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">accuracy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(y_hat, y), X.shape[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            timer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">stop</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            train_l </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> metric[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> metric[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            train_acc </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> metric[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> metric[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (i </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (num_batches </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">//</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> or</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> i </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> num_batches </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                animator.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(epoch </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (i </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> num_batches,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                             (train_l, train_acc, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">None</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        test_acc </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> evaluate_accuracy_gpu</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(net, test_iter)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        animator.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(epoch </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">None</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">None</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, test_acc))</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;loss: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">train_l</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:.3f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, train acc: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">train_acc</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:.3f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, &#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">          f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;test acc: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">test_acc</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:.3f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">metric[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> num_epochs </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> timer.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">sum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:.1f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> examples/sec &#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">          f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;on </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">str</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(device)</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/dcbestwords/edit/main/src/paper/code/torch_api.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="vp-meta-info" data-allow-mismatch="text">2024/12/3 11:20:13</span></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 1114686398@qq.com">dachao</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">åƒå¥½é¥­ï¼Œèµ°å¥½è·¯</div><div class="vp-copyright">Copyright Â© 2025 Dachao </div></footer></div><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-C3nmoAdO.js" defer></script>
  </body>
</html>
